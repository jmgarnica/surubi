{
	"lineEnd": "\n",
	"correct": 
	[
		{
			"name": "list of types with type hiding",
			"code": "let
						type a = {b: string}
						var b: a:= nil
					in
						printi(
							let
								type f = array of a
								type a = int

								var v : f := nil
							in
								v := f[10] of -1;
								v[3] := 3;
								v[3]
							end);
						b := a{b= \"record\"};
						b.b
					end",
			"correctOutput": "3record"
		},
		{
			"name": "comparison test",
			"code": "let
					   var n1 := 5
					   var n2 := 7
					   var s1 := \"blablabla\"
					   var s2 := \"blablablz\"
					in
					    if n1 > n2 then print(\"nop\") else print(\"yep\");
					    if s1 < s2 then print(\"yep\") else print(\"nop\");
					    if n2 >= n1 then print(\"yep\") else print(\"nop\");
					    if s1 >= s2 then print(\"yep\") else print(\"nop\")
					end",
			"correctOutput":"yepyepyepnop"
		},
		{
			"name": "printiline",
			"code": "printiline(2017)",
			"correctOutput": "2017\n"
		},
		{
			"name": "printline",
			"code": "printline(\"moana\")",
			"correctOutput": "moana\n"
		},
		{
			"name": "exit",
			"code": "exit(9)",
			"exitCode": 9,
			"correctOutput": ""
		},	
		{
			"name": "size",
			"code": "let
						var c : int := 1 + size(\"\")
						var s := size(\"la la land\")
					in
						printi(c);
						printi(s)
					end",
			"correctOutput": "110"
		},
		{
			"name": "not",
			"code": "(printi(0);
					printi(not(100));
					print(\" \");
					printi(not(0)))",
			"correctOutput": "00 1"
		},
		{
			"name": "escape chars",
			"code": "let
					    /* msg1 is: Can you read this? */
					    var msg1 := \"\\067\\097\\110\\032\\121\\111\\117\\ 

					    \\\\032\\114\\101\\097\\100\\032\\116\\104\\105\\115\\063\"
					    var msg2 := \"\\n\\\"Quoted string\\\"\"
					in
					    print(msg1);
					    print(\"\\n\");
					    print(msg2)
					end",
			"correctOutput" : "Can you read this?\n\n\"Quoted string\""
		},
		{
			"name": "Eratosthene's sieve",
			"code": "let
						type int_array = array of int
						var size := 100
						var sieved := int_array[size] of 0

						function mod(n : int, m : int) : int = n - m * (n / m)

						function mark_multiples(n : int) =
						  let var i := n in
						    while i < size do (
						      if not(mod(i, n)) then sieved[i] := 1;
						      i := i + n
						    )
						  end

						function step(n : int) =
						  if not(sieved[n]) then (
						    printi(n); print(\"\\n\");
						    mark_multiples(n)
						  )

					in
						  for i := 2 to (size - 1) do step(i)
					end",
			"correctOutput": "2\n3\n5\n7\n11\n13\n17\n19\n23\n29\n31\n37\n41\n43\n47\n53\n59\n61\n67\n71\n73\n79\n83\n89\n97\n"
		},
		{
			"name" : "records",
			"code" : "let
						type  rectype = {name:string, age:int}
						var rec1:rectype := rectype {name=\"Nobody\", age=1000}
					in
						rec1.name := \"Somebody\";
						printi(rec1.age);
						print(rec1.name);
						0
					end",
			"correctOutput": "1000Somebody"
		},
		{
			"name": "nil record",
			"code": "let
						type rectype = {name:string, id:int}
						var b:rectype := nil
					in
						b := nil;
						if b <> nil then 1 else 0
					end"
		},
		{
			"name": "types hiding",
			"code": "let
						type a = int
					in
						print(
							let
								var i : a := 0
								type a = string
								var j : a := \"la\"
							in
								printi(i);
								j
							end)
					end",
			"correctOutput": "0la"
		},
		{
			"name": "array init",
			"code": "let
						var N := 10
						var arr1: int := 0

						type  arrtype = array of a
						type  b = arrtype
						type  a = int

						var arr1:b := arrtype [N] of (arr1 := arr1 + 1; arr1)
					in
						for i:=0 to N - 1 do printi(arr1[i])
					end",
			"correctOutput" : "12345678910"
		},
		{
			"name" : "let{for}",
			"code" : "let
						var a:= 0
					in 
						for i:=0 to 100 do (a:=a+1;());
						printi(a)
					end",
			"correctOutput": "101"
		},		
		{
			"name": "fact",
			"code": "let 
						function fact(n: int, ac: int) : int = 
							if n = 0 then ac else fact(n-1, n*ac) 
					in 
						printi(fact(argc - 1, 1)) 
					end",
			"args": ["1", "1", "1", "1", "1"],
			"correctOutput": "120"
		},
		{
      		"name": "eightqueens",
      		"code":	"let /* The eight queens solver from Appel */
      					var Count := 0
						var N := 8 
						type intArray = array of int 
						var row := intArray [ N ] of 0
						var col := intArray [ N ] of 0
						var diag1 := intArray [ N+N-1 ] of 0
						var diag2 := intArray [ N+N-1 ] of 0

						function printboard() =
							(for i := 0 to N-1
								do (for j := 0 to N-1
										do print(if col[i]=j then \" O\" else \" .\");
									print(\"\\n\"));
							Count := Count + 1;
							print(\"\\n\"))

						function try(c:int) =
							if c=N then printboard()
							else for r := 0 to N-1
									do if row[r]=0 &
										diag1[r+c]=0 & diag2[r+7-c]=0
										then (row[r] := 1; diag1[r+c] := 1;
											diag2[r+7-c] := 1; col[c] := r;
											try(c+1);
											row[r] := 0; diag1[r+c] := 0;
											diag2[r+7-c] := 0)
					in
						try(0);
						Count
					end",
			"exitCode" : 92
		},
		{
			"name": "strcmp",
			"code": "if \"aa\" = args[1] then (print(args[1]); 0) else -1",
			"args": ["aa"],
			"correctOutput": "aa"
		},
		{
			"name": "mutually recursive functions",
			"code": "let
						function do_nothing1(a: int, b: string):int=
								(do_nothing2(a+1);0)

						function do_nothing2(d: int):string =
							if d <> 10 then
								(printi(d); do_nothing1(d, \"str\");\" \")
							else \"loop avoided\"

					in
						do_nothing1(0, \"str2\")
					end",
			"correctOutput" : "123456789"
		},
		{
			"name" : "local hides global (var)",
			"code" : "let
						var a:=0
						function f() = printi(a)
						var a:= 5
						function h() = printi(a)
						function g(a:int):int = a 
					in
						(h();
						f(); 
						printi(g(2));
						0)
					end",
			"correctOutput": "502"
		}
	],
	"fail":
	[
		{
			"name": "not var",
			"code": "3*4+printi(a)",
			"errors":
			[
				{
					"error": "Unknown symbol a",
					"line": 1,
					"column": 11
				}
			],
			"failOn": "SemanticCheck"			
		},
		{
			"name": "funct",
			"code": "if argc = 2 
						then 
							print(\"la\") 
						else 
							let 
								var a : int := 0
							in 
								a + print(\"el\")
							end",
			"errors":
			[
				{
					"error": "^[\\w\\W]*void[\\w\\W]*must[\\w\\W]*be[\\w\\W]*type[\\w\\W]*int[\\w\\W]*$",
					"line": 8
				}
			],
			"failOn": "SemanticCheck"
		},
		{
			"name": "str in for",
			"code": "for i := 10 to \" \" do i := i - 1",
			"failOn": "SemanticCheck"
		},
		{
			"name": "bad while",
			"code": "while 10 > 5 do (i+1;())",
			"failOn": "SemanticCheck"
		},
		{
			"name": "std redefinition",
			"code": "let type int = string var s : int := \"this is a string\" in s end",
			"failOn": "SemanticCheck"
		},
		{
			"name": "null reference",
			"code": "let
						type e = { a: string, b: int}
						var d : e := nil
					in
						d.b
					end",
			"failOn": "Execution",
			"exitCode" : 3,
			"errors":
			[
				{
					"error": "Null Reference"
				}
			]
		},
		{
			"name": "index out of range",
			"code": "let
						var N := 100
						type e = array of int
						var d := e[N] of -1
					in
						for i := 0 to N do (printi(d[i]); d[i])
					end",
			"failOn": "Execution",
			"exitCode" : 1,
			"errors":
			[
				{
					"error": "Index out of range"
				}
			]
		},
		{
			"name": "invalid cyclic types",
			"code": "let
						type a = b
						type b = array of c
						type c = {f: a}
						type d = array of g
						type g = h
						type h = array of d
					in 
						0
					end",
			"failOn": "SemanticCheck"
		}
	]
}

